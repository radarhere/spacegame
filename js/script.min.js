var colours=["red","blue","green"];function Star(e,t,i,s,r,o,a){this.firstContact=!1,this.selected=!1,this.type=e,this.x=this.resetX=t,this.y=this.resetY=i,this.radius=s,this.rotation=0,this.directionX=1,this.directionY=1,void 0===r||void 0===o?(this.speedX=0,this.speedY=0):(this.speedX=r,this.speedY=o,this.speedX<0&&(this.speedX=-this.speedX,this.directionX=-1),this.speedY<0&&(this.speedY=-this.speedY,this.directionY=-1)),this.resetSpeedX=this.speedX,this.resetSpeedY=this.speedY,this.resetDirectionX=this.directionX,this.resetDirectionY=this.directionY,this.colour=a,this.reset=function(){this.firstContact=!1,this.speedX=this.resetSpeedX,this.speedY=this.resetSpeedY,this.x=this.resetX,this.y=this.resetY,this.directionX=this.resetDirectionX,this.directionY=this.resetDirectionY},this.draw=function(){var e=verticalPosition,t=effectiveCanvas.width,i=effectiveCanvas.height;if(!this.firstContact){if(!(this.y+this.radius>e&&this.y-this.radius<e+i))return;this.firstContact=!0}return!remain&&(this.y+this.radius<0||this.y-this.radius>18e3)?"destroy":(this.x+=this.directionX*this.speedX,this.y+=this.directionY*this.speedY,"asteroid"==this.type&&(this.x+this.radius>t&&(this.directionX=-1,this.x=t-this.radius),this.x-this.radius<0&&(this.directionX=1,this.x=this.radius),remain&&(this.y-this.radius<0&&(this.directionY=1,this.y=this.radius),this.y+this.radius>18e3&&(this.directionY=-1,this.y=18e3-this.radius))),this.y+this.radius>e&&this.y-this.radius<e+i?(this.selected?(ctx.fillStyle="rgb(0, 255, 0)",ctx.arc(this.x,yPoint(this.y),this.radius,-2*Math.PI,0,!1),ctx.fill(),"asteroid"==this.type&&(ctx.font="36px",ctx.textAlign="left",ctx.textBaseline="bottom",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText(this.resetSpeedX,this.x-10,yPoint(this.y)+10),ctx.fillText(this.resetSpeedY,this.x-10,yPoint(this.y)+35))):"star"==this.type?"red"==this.colour?ctx.drawImage(star_redImage,this.x-this.radius,yPoint(this.y)-this.radius):"green"==this.colour?ctx.drawImage(star_greenImage,this.x-this.radius,yPoint(this.y)-this.radius):ctx.drawImage(star_blueImage,this.x-this.radius,yPoint(this.y)-this.radius):(ctx.save(),ctx.translate(this.x,yPoint(this.y)),this.rotation+=this.directionY*this.speedY,360==this.rotation&&(this.rotation=0),ctx.rotate(this.rotation/180*Math.PI),ctx.drawImage(asteroidImage,-this.radius,-this.radius),ctx.restore()),"present"):"absent")}}function collision(e,t){return!(Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))>e.radius+t.radius)&&(0==e.speedX?e.directionX=-t.directionX:0==t.speedX&&(t.directionX=-e.directionX),0==e.speedY?e.directionY=-t.directionY:0==t.speedY&&(t.directionY=-e.directionY),e.x>t.x+10?(e.directionX=1,t.directionX=-1):t.x>e.x+10&&(t.directionX=1,e.directionX=-1),e.speedY=t.speedY=(e.speedY+t.speedY)/2,e.y>t.y+10?(e.directionY=1,t.directionY=-1):t.y>e.y+10&&(t.directionY=1,e.directionY=-1),e.speedX=t.speedX=(e.speedX+t.speedX)/2,!0)}function heroCollision(e){var t,i=!1,s=hero.x,r=yPoint(hero.y),o=e.x,a=yPoint(e.y);for(var n in hero.coords){var l;if(t=(l=hero.rotate)%2==0?hero.coords[n]:hero.rotatedCoords[n],0==l||1==l?(heroX=s+t[0],heroY=r+t[1]):2==l||3==l?(heroX=s-t[1],heroY=r+t[0]):4==l||5==l?(heroX=s-t[0],heroY=r-t[1]):6!=l&&7!=l||(heroX=s+t[1],heroY=r-t[0]),starX=o-heroX,starY=a-heroY,e.radius>=Math.sqrt(Math.pow(starY,2)+Math.pow(starX,2))){i=!0;break}}return i}function drawDashboard(e){ctx.fillStyle="rgb(100, 100, 100)",ctx.fillRect(0,effectiveCanvas.height,effectiveCanvas.width,60),ctx.fillStyle="rgb(0, 0, 0)",ctx.fillRect(230,505,510,45),drawLives(),drawConsole("Score: "+score.toString()),drawDial(50,530,20,(e.x-50)/650*360-180,"rgb(151, 235, 96)"),drawDial(120,530,20,(e.relativeY-50)/400*360-180,"rgb(73, 198, 255)"),drawDial(190,530,20,(e.y-100)/17900*360-180,"rgb(255, 78, 29)")}function drawLives(){lives>3&&ctx.drawImage(heroImage,550,507,50,50),lives>2&&ctx.drawImage(heroImage,590,507,50,50),lives>1&&ctx.drawImage(heroImage,630,507,50,50),lives>0&&ctx.drawImage(heroImage,670,507,50,50)}function drawDial(e,t,i,s,r){ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 0)",ctx.arc(e,t,i,(s/180-2)*Math.PI,s/180*Math.PI,!1),ctx.fill(),ctx.strokeStyle=r,ctx.lineWidth=2,ctx.lineTo(e,t),ctx.stroke()}function drawConsole(e){ctx.font="32px Arial",ctx.textAlign="left",ctx.textBaseline="bottom",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText(e,250,545)}function drawGameOver(){var e,t,i;0==lives?(e="GAME OVER",t="96px Arial",i=150):(e="CONGRATULATIONS",t="64px Arial",i=120),ctx.font=t,ctx.textAlign="center",ctx.textBaseline="bottom",ctx.fillStyle="rgb(0, 0, 0)",ctx.fillText(e,375,i),ctx.font="46px Arial",ctx.textAlign="center",ctx.textBaseline="bottom",ctx.fillStyle="rgb(0, 0, 0)",ctx.fillText("PRESS RETURN TO TRY AGAIN",375,450)}var asteroidRebound=new Audio("effects/asteroidRebound.wav");asteroidRebound.volume=.3;var collectStar=new Audio("effects/collectStar.wav");function CollectStars(){this.sounds=[collectStar,collectStar.cloneNode(),collectStar.cloneNode()],this.i=0,this.play=function(){this.sounds[this.i].play(),this.i++,3==this.i&&(this.i=0)}}collectStar.volume=.3,collectStars=new CollectStars;var activateHyperdrive=new Audio("effects/activateHyperdrive.wav"),loseLife=new Audio("effects/loseLife.wav");loseLife.volume=.5;var extraLife=new Audio("effects/extraLife.wav");extraLife.volume=.5;var gameOver=new Audio("effects/gameOver.wav");gameOver.volume=.6;var theme=[],currentTheme=null,sounds=[asteroidRebound,collectStar,activateHyperdrive,extraLife,gameOver];function muted(){return"muted"==document.getElementById("sound").className}function playSound(e){muted()||("asteroidRebound"==e?asteroidRebound.play():"collectStar"==e?collectStars.play():"activateHyperdrive"==e?activateHyperdrive.play():"loseLife"==e?loseLife.play():"extraLife"==e?extraLife.play():"gameOver"==e&&gameOver.play())}window.onload=function(){const e=document.getElementById("sound");"undefined"!=typeof Cookies&&0==Cookies.get("volume")&&(e.classList.add("muted"),e.querySelector("span").innerText="Sound Off"),e.addEventListener("click",(function(){this.classList.toggle("muted");const e=this.querySelector("span");this.classList.contains("muted")?(e.innerText="Sound Off","undefined"!=typeof Cookies&&Cookies.set("volume",0,{expires:30}),null!=currentTheme&&currentTheme.pause()):(e.innerText="Sound On","undefined"!=typeof Cookies&&Cookies.set("volume",1,{expires:30}),null!=currentTheme&&currentTheme.play())})),document.querySelector(".loading").remove(),document.querySelectorAll("#game, #sound").forEach((e=>{e.style.display="block"}));const t=document.getElementById("game");effectiveCanvas={width:t.width,height:t.height-60},ctx=t.getContext("2d"),resetScore(),resetGame(),setInterval(update,17)};var gate=null;function Gate(e,t){this.x=e,this.y=t,this.radius=75,this.locked=!1,this.draw=function(){var e=effectiveCanvas.height,t=verticalPosition;return this.y+this.radius>t&&this.y-this.radius<t+e?(ctx.drawImage(gateRingImage,this.x-this.radius,yPoint(this.y)-this.radius),null!=timePosition&&autopilot?(currentTheme.volume=-1*timePosition/100,ctx.globalAlpha=(timePosition+100)/100,ctx.drawImage(gatePlatformImage,this.x-this.radius,yPoint(this.y)-this.radius),ctx.globalAlpha=1):this.locked&&ctx.drawImage(gatePlatformImage,this.x-this.radius,yPoint(this.y)-this.radius),"present"):"absent"},this.drawInShip=function(){hero.x-1>this.x?hero.x-=1:hero.x+1<this.x?hero.x+=1:hero.x!=this.x&&(hero.x=this.x),hero.y-1>this.y?hero.y-=1:hero.y+1<this.y?hero.y+=1:hero.y!=this.y&&(hero.y=this.y),hero.calculatePosition()},this.rotateShip=function(){hero.rotate-.05>0?hero.rotate-=.05:hero.rotate=0},this.detect=function(){heroCollision(this)&&(autopilot=!0,timePosition=-100)},this.autopilot=function(){hero.x!=this.x||hero.y!=this.y?this.drawInShip():0!=hero.rotate||0!=timePosition?(timePosition+1<0?timePosition+=1:timePosition=0,this.rotateShip()):(currentTheme.pause(),currentTheme.volume=1,playSound("activateHyperdrive"),autopilot=!1,hyperdrive=!0,gate.locked=!0,timeSequence=spinHyperdrive)}}var backgroundLoaded,numberLoaded=0,gateRingImage=new Image;gateRingImage.src="images/gateRing.png",gateRingImage.onload=function(){numberLoaded++};var gatePlatformImage=new Image;gatePlatformImage.src="images/gatePlatform.png",gatePlatformImage.onload=function(){numberLoaded++};var heroImage=new Image;heroImage.src="images/spaceship.png",heroImage.onload=function(){numberLoaded++};var enginesImage=new Image;enginesImage.src="images/spaceshipMotion.png",enginesImage.onload=function(){numberLoaded++};var backgroundImages=[],asteroidImage=new Image;asteroidImage.src="images/asteroid.png",asteroidImage.onload=function(){numberLoaded++};var star_blueImage=new Image;star_blueImage.src="images/star_blue.png",star_blueImage.onload=function(){numberLoaded++};var star_redImage=new Image;star_redImage.src="images/star_red.png",star_redImage.onload=function(){numberLoaded++};var star_greenImage=new Image;star_greenImage.src="images/star_green.png",star_greenImage.onload=function(){numberLoaded++};var starPath=[[375,440],[375,605],[375,807.5],[375,987.5],[375,1175],[375,1392.5],[375,1617.5],[375,2045],[517.5,2187.5],[667.5,2337.5],[520,2480],[375,2653],[175,2825],[50,2927.5],[50,3612.5],[147.5,3612.5],[305,3612.5],[425,3612.5],[575,3612.5],[700,3612.5],[375,3912.5],[375,4152.5],[375,4385],[375,4550],[375,4985],[212.5,5180],[375,5180],[537.5,5180],[50,5435],[212.5,5435],[375,5435],[537.5,5435],[700,5435],[618.5,5667.5],[456.5,5667.5],[293.5,5667.5],[131.5,5667.5],[212,5822.5],[375,5822.5],[538,5822.5],[300,5977.5],[450,5977.5],[375,6072.5],[77.5,6860],[220,6987.5],[375,7175],[542.5,7310],[700,7467.5],[490,7835],[272.5,8075],[375,8435],[375,9072.5],[375,9282.5],[375,9425],[375,9597.5],[375,9747.5],[115,10272.5],[265,10422.5],[460,10617.5],[602.5,10760],[580,11210],[467.5,11345],[265,11547.5],[115,11697.5],[375,12260],[375,12507.5],[357.5,13122.5],[375,13505],[375,13992.5],[375,14570],[175,14570],[575,14570],[375,14690],[375,14450],[375,15192.5],[375,15425],[375,15620],[375,15775],[175,15825],[575,15825],[275,15925],[475,15925],[375,16025],[375,16617.5],[375,16760],[375,16932.5],[375,17090],[175,17125],[575,17125],[275,17225],[475,17225],[375,17325]],asteroidPath=[[137.5,8277.5,0,0],[512.5,9680,5,0],242.5,[618.75,12627.5,-3,0],[131.25,12807.5,3,0],[618.75,12950,-3,0],[490,14247.5,-2,2],[212.5,14150,2,2],[70,16992.5,0,0],[670,16992.5,0,0],[145,16445,4,-4],[131.25,16027.5,5,0],[370,15097.5,0,0],[587.5,14855,-2,3],[85,14705,2,2],[580,13705,0,0],[137.5,13317.5,0,0],[122.5,13040,3,-4],[618.75,12012.5,0,0],[377.5,12012.5,0,0],[131.25,12012.5,0,0],[385,11802.5,0,0],[537.5,10992.5,4,0],[212.5,10992.5,-2,0],[377.5,10992.5,0,0],[377.5,9935,0,0],[537.5,8562.5,-3,3],[375,8782.5,0,-3],[377.5,6807.5,0,-2],[700,6080,-3,-3],[50,6080,3,-3],[618.75,4730,-1,0],[212.5,4475,1,0],[618.75,4257.5,-3,0],[131.25,4032.5,3,0],[618.75,3237.5,-3,0],[131.25,3237.5,3,0],[212.5,1077.5,0,0],[618.75,325,0,0]],level1Stars=new Array;for(i in starPath)level1Stars.push(new Star("star",starPath[i][0],starPath[i][1],14.5,0,0,colours[Math.floor(Math.random()*colours.length)]));for(j in asteroidPath)level1Stars.push(new Star("asteroid",asteroidPath[j][0],asteroidPath[j][1],30,asteroidPath[j][2],asteroidPath[j][3]));var level2Stars=new Array,level3Stars=new Array,level4Stars=new Array,level5Stars=new Array;function generateStars(e,t,i,s){for(null==s&&(s=17250),starLimit=s,asteroidLimit=s-200,r=0;r<t;r++)e.push(new Star("star",Math.floor(500*Math.random()+100),Math.floor(Math.random()*starLimit+250),14.5,0,0,colours[Math.floor(Math.random()*colours.length)]));for(var r=0;r<i;r++)e.push(new Star("asteroid",Math.floor(500*Math.random()+100),Math.floor(Math.random()*asteroidLimit+450),30,Math.floor(10*Math.random()-5),Math.floor(10*Math.random()-5)))}generateStars(level2Stars,60,50),generateStars(level3Stars,60,60),generateStars(level4Stars,50,60),generateStars(level5Stars,80,70,16e3);var planet,highScorePosition,levelStars=[level1Stars,level2Stars,level3Stars,level4Stars,level5Stars];function Planet(){this.detect=function(){hero.y>17575&&(hero.rotate=0,autopilot=!0,timePosition=0)},this.autopilot=function(){hero.y+hyperdriveOffset+120<18e3?(hyperdriveOffset+=2,hero.calculatePosition()):(autopilot=!1,hyperdrive=!0,hero.y=17500,timeSequence=noPlaceLikeHome)}}var name,scores,highScoreId=null,nameFlicker=0;function drawScores(){ctx.font="96px",ctx.textBaseline="bottom",ctx.fillStyle="rgb(0, 0, 0)",highScorePosition=null;var e,t,i=0;for(e in scores){if(t=scores[e].toString(),e=e.substr(0,3),i+=1,ctx.textAlign="left","___"==e){if(highScorePosition=i,ctx.fillStyle="rgb(200, 0, 0)",name.length<3)if((nameFlicker+=1)>60)nameFlicker=0;else if(nameFlicker<30){var s;0==name.length?s="":1==name.length?s=" ":2==name.length&&(s="  "),ctx.fillText(s+"_",75,120+80*i)}ctx.fillText(name,75,150+80*i),ctx.fillStyle="rgb(0, 0, 0)"}else ctx.fillText(e,75,150+80*i);ctx.textAlign="right",ctx.fillText(t,675,150+80*i)}}function acceptKey(e){var t=String.fromCharCode(e);t.search(/[A-Z]/)||(name+=t,ctx.font="76px",ctx.textAlign="left",ctx.fillText(name,75,150+80*highScorePosition),name.length>2&&(highScorePosition=null,saveScore(name=name.substr(0,3))))}function saveScore(e){fetch("ajax/scores.php?name="+e+"&id="+highScoreId).then((e=>e.json())).then((e=>{scores=e.scores,highScoreId=null}))}function getScores(){fetch("ajax/scores.php?score="+score+"&level="+level).then((e=>e.json())).then((e=>{scores=e.scores,highScoreId=e.id,nameFlicker=0}))}function Hero(){this.width=100,this.height=100,this.speed=7.5,this.engines=!1,this.rotate=0,this.collision=!1,this.flicker=0,this.coords=[[0,20],[0,-50],[-30,15],[30,15],[-30,10],[30,10],[-14,-6],[14,-6],[22,3],[-22,3],[7,-28],[-7,-28]],this.rotatedCoords=[[-14,14],[35,-35],[-31,-10],[10,31],[-28,-14],[14,28],[-5,-14],[14,5],[13,17],[-17,-13],[24,-14],[14,-24]],this.reset=function(){this.x=effectiveCanvas.width/2,this.y=effectiveCanvas.height/4,this.rotate=0},this.draw=function(){if(!this.collision||(this.flicker+=1,3==this.flicker&&(this.flicker=0),0==this.flicker)){var e=this.x,t=500-this.relativeY-hyperdriveOffset;ctx.save(),ctx.translate(e,t),ctx.rotate(Math.PI/4*this.rotate),this.engines?ctx.drawImage(enginesImage,-this.width/2,-this.height/2):ctx.drawImage(heroImage,-this.width/2,-this.height/2),ctx.restore()}},this.fireEngines=function(){this.engines=!0,37 in keysDown&&!(39 in keysDown)?this.rotate=38 in keysDown&&!(40 in keysDown)?7:40 in keysDown&&!(38 in keysDown)?5:6:39 in keysDown&&!(37 in keysDown)?this.rotate=38 in keysDown&&!(40 in keysDown)?1:40 in keysDown&&!(38 in keysDown)?3:2:40 in keysDown&&!(38 in keysDown)?this.rotate=4:38 in keysDown&&!(40 in keysDown)||38 in keysDown?this.rotate=0:this.engines=!1,38 in keysDown&&(this.y+=this.speed),40 in keysDown&&(this.y-=this.speed),this.calculatePosition(),37 in keysDown&&(this.x-=this.speed),39 in keysDown&&(this.x+=this.speed),this.x+this.width/2>effectiveCanvas.width&&(this.x=effectiveCanvas.width-this.width/2),this.x<this.width/2&&(this.x=this.width/2)},this.calculatePosition=function(){this.y+this.height/2>17500+effectiveCanvas.height?this.y=verticalPosition+effectiveCanvas.height-this.height/2:this.y<this.height/2&&(this.y=this.height/2),this.y<effectiveCanvas.height/2?(verticalPosition=0,this.relativeY=this.y):this.y>17500+effectiveCanvas.height/2?(verticalPosition=17500,this.relativeY=this.y-verticalPosition):(this.relativeY=effectiveCanvas.height/2,verticalPosition=this.y-effectiveCanvas.height/2)}}var hero=new Hero,verticalPosition=0;function yPoint(e){return effectiveCanvas.height-e+verticalPosition}function drawBlack(){ctx.fillStyle="rgb(0, 0, 0)",ctx.fillRect(0,0,effectiveCanvas.width,effectiveCanvas.height)}function drawWhite(){ctx.fillStyle="rgb(255, 255, 255)",ctx.fillRect(0,0,effectiveCanvas.width,effectiveCanvas.height)}function drawStars(){var e=18e3-verticalPosition;null!=gate&&(e-=hyperdriveOffset),ctx.drawImage(backgroundImages[level-1],0,e,750,500,0,0,750,500)}function drawSpace(){drawBlack(),drawStars()}function fadeToWhite(){ctx.fillStyle="rgba(255, 255, 255, 0.5)",ctx.fillRect(0,0,effectiveCanvas.width,effectiveCanvas.height)}function fadeFromWhite(e){var t=1-e;ctx.fillStyle="rgba(255, 255, 255, "+t.toString()+")",ctx.fillRect(0,0,effectiveCanvas.width,effectiveCanvas.height)}function fadeInText(){ctx.font="84px",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="rgba(0, 0, 0, 0.25)",ctx.fillText("LEVEL "+["TWO","THREE","FOUR","FIVE"][level-1],375,200),ctx.fillText(["ANDROMEDA","THE MILKY WAY","ALPHA CENTAURI","EARTH"][level-1],375,300)}var ctx,effectiveCanvas,spinHyperdrive=[[20,function(){hyperdriveOffset+=1,drawStars()}],[5,function(){hyperdriveOffset+=2,drawStars()}],[10,function(){hyperdriveOffset+=7,drawStars()}],[8,function(){hyperdriveOffset+=42,drawStars()}],[34,function(){hyperdriveOffset+=3,timePosition%5==0&&fadeToWhite()}],[30,function(){timePosition%5==0&&fadeInText()}],[1,function(){loadLevel(level+1)}],[119,function(){}],[30,function(){timePosition%5==0&&fadeToWhite()}],[1,function(){resetGame(),hyperdrive=!0,hyperdriveOffset=0,hero.engines=!1,hero.calculatePosition(),null!=gate&&(gate.locked=!1)}],[90,function(e){drawObjectsInSpace(),fadeFromWhite(e)},!0],[null,function(){hyperdrive=!1}]],fadeOut=[[70,function(){currentTheme.volume=(100-timePosition)/100}],[30,function(){timePosition%5==0&&fadeToWhite(),currentTheme.volume=(100-timePosition)/100}]],noPlaceLikeHome=[[70,function(){currentTheme.volume=(100-timePosition)/100}],[30,function(){timePosition%5==0&&fadeToWhite(),currentTheme.volume=(100-timePosition)/100}],[200,function(){(110==timePosition||170==timePosition||230==timePosition||290==timePosition)&&lives>0&&(1==lives?(lives=-1,timePosition=290):lives-=1,score+=1e3,playSound("extraLife"))}],[1,function(){hyperdriveOffset=0}]],endScreen=[[1,function(){currentTheme.pause(),currentTheme.volume=1,name="",scores=null,getScores()}],[29,function(){}],[null,function(){highScores=!0}]];fadeOut=fadeOut.concat(endScreen),noPlaceLikeHome=noPlaceLikeHome.concat(endScreen);var remain,stars,level,score,lives,invincible=!1,autopilot=!1,hyperdrive=!1,hyperdriveOffset=0,timePosition=null,timeSequence=null,levelLimit=5,highScores=!1,slowTime=null,playTheme=!1,keysDown={};function drawObjects(){var e,t,i=!1,s=[],r=!0;for(var o in stars)if("destroy"==(t=(e=stars[o]).draw()))stars.splice(o,1),o--;else if("present"==t&&(null==timePosition&&heroCollision(e)&&("star"==e.type?(stars.splice(o,1),o--,(score+=100)%5e3==0&&lives<4?(lives+=1,playSound("extraLife")):playSound("collectStar")):"asteroid"==e.type&&(invincible||(r=!1,hero.collision||(0!=(lives-=1)?(playSound("loseLife"),slowTime=5,hero.collision=!0):(playSound("gameOver"),i=!0))))),"asteroid"==e.type)){for(var a in s)collision(e,s[a])&&playSound("asteroidRebound");s.push(e)}hero.collision&&r&&(hero.collision=!1,hero.flicker=0,invincible=!0),i&&(hyperdrive=!0,timePosition=0,timeSequence=fadeOut)}function advanceTime(){if(null!=timePosition&&null!=timeSequence){var e,t,s;timePosition+=1;var r=0;for(i in timeSequence){if(e=timeSequence[i][0],t=timeSequence[i][1],s=null!=timeSequence[i][2],null==e){t(),timePosition=null;break}if(r+e>timePosition){s?t((timePosition-r)/e):t();break}r+=e}null==timePosition&&(timeSequence=null)}}function drawObjectsInSpace(){drawSpace(),drawObjects(),null!=gate&&gate.draw(),hero.draw()}function update(){if(8==numberLoaded&&backgroundLoaded){if(null!=slowTime)if(slowTime-=1,hero.collision){if(slowTime%5!=0)return;slowTime=5}else(slowTime-=1)<-70&&(slowTime=null,invincible=!1);if(highScores){if(null!=highScorePosition)for(var e in keysDown)delete keysDown[e],acceptKey(e);return drawWhite(),drawGameOver(),void drawScores()}ctx.beginPath(),advanceTime(),hyperdrive?0!=hyperdriveOffset&&hero.draw():(autopilot&&(5==level?planet.autopilot():gate.autopilot()),null==timePosition&&hero.fireEngines(),drawObjectsInSpace()),null==timePosition&&(null!=gate?gate.detect():5==level&&planet.detect()),drawDashboard(hero),playTheme&&(playTheme=!1,muted()||currentTheme.play())}}function loadLevel(e){if(remain=(level=e)>3,level<=backgroundImages.length)currentTheme=theme[e-1];else{backgroundLoaded=!1;var t=new Image;t.src="images/level"+level.toString()+".png",t.onload=function(){backgroundImages.push(t),backgroundLoaded=!0},currentTheme=new Audio("effects/level"+level.toString()+".mp3"),theme.push(currentTheme),currentTheme.loop=!0}}function resetGame(){for(var e in hyperdrive=!1,stars=levelStars[level-1].slice(0))stars[e].reset();level==levelLimit?(gate=null,planet=new Planet):null==gate&&(gate=new Gate(375,17750)),hero.reset(),playTheme=!0}function resetScore(){loadLevel(1),score=0,lives=3}addEventListener("keydown",(function(e){highScores&&13==e.keyCode&&(highScores=!1,resetScore(),resetGame()),37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode||e.preventDefault(),keysDown[e.keyCode]=!0}),!1),addEventListener("keyup",(function(e){delete keysDown[e.keyCode]}),!1);